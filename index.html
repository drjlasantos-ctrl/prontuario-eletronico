<!DOCTYPE html><html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ProntuÃ¡rio Emagrecimento</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      margin: 0; padding: 20px; background-color: #f2f2f2; color: #333;
    }
    h2 {
      text-align: center; color: #007b5f;
    }
    form {
      background-color: #fff; padding: 20px; border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    label {
      margin-top: 10px; display: block; font-weight: bold;
    }
    input, select, textarea {
      width: 100%; padding: 10px; margin-top: 5px;
      border-radius: 8px; border: 1px solid #ccc; font-size: 1em;
    }
    button {
      padding: 12px 20px; margin: 15px 5px 0 0;
      background-color: #007b5f; color: white; border: none;
      border-radius: 8px; font-size: 1em; cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #005f49;
    }
    #resumo {
      background-color: white; padding: 20px;
      border-radius: 10px; margin-top: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }
    #acoes {
      display: flex; flex-direction: column; gap: 10px; margin-top: 15px;
    }
    #mensagemStatus {
      margin-top: 10px; font-weight: bold;
    }
    @media (min-width: 600px) {
      #acoes { flex-direction: row; }
    }
  </style>
</head>
<body>
  <h2>ðŸ“‹ Ficha de Acompanhamento - Emagrecimento</h2>
  <form id="formulario">
    <label>Nome:</label><input type="text" name="nome">
    <label>Sexo:</label>
    <select name="sexo">
      <option value="masculino">Masculino</option>
      <option value="feminino">Feminino</option>
    </select>
    <label>Idade:</label><input type="number" name="idade">
    <label>Peso (kg):</label><input type="number" step="0.1" name="peso">
    <label>Altura (cm):</label><input type="number" step="0.1" name="altura">
    <label>Cintura (cm):</label><input type="number" name="cintura">
    <label>TÃ³rax (cm):</label><input type="number" name="torax">
    <label>BÃ­ceps Direito (cm):</label><input type="number" name="biceps_d">
    <label>BÃ­ceps Esquerdo (cm):</label><input type="number" name="biceps_e">
    <label>FrequÃªncia CardÃ­aca:</label><input type="number" name="fc">
    <label>PressÃ£o Arterial:</label><input type="text" name="pa">
    <label>Data da prÃ³xima consulta:</label><input type="date" name="proxima">
    <label>ObservaÃ§Ã£o:</label><textarea name="observacao"></textarea>
    <label>Foto do paciente:</label><input type="file" accept="image/*" id="fotoPaciente">
    <button type="button" onclick="gerarResumo()">âœ… Finalizar Consulta</button>
  </form>
  <div id="resumo" style="display:none;"></div>
  <div id="acoes" style="display:none;">
    <button onclick="baixarPDF(true)">ðŸ“„ Baixar PDF</button>
    <button onclick="salvarNoDrive()">ðŸ’¾ Salvar no Drive</button>
    <button onclick="enviarWhatsApp()">ðŸ“² Enviar por WhatsApp</button>
  </div>
  <div id="mensagemStatus"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const { jsPDF } = window.jspdf;
    const LOGO_BASE64 = "data:image/png;base64,...";
    const GAS_URL = "https://script.google.com/macros/s/AKfycbz726bRq3cHtWOn4473KzD--dpj4Soih8FKgZVKmSi4oCJxHMjvfHYWmuWReh2RCfCYsQ/exec";
    const DRIVE_FOLDER_ID = "1-ZLwdv_thQtBe2JBc_f90P2x0nOmI4UU";

    function gerarResumo() {
      const form = document.forms['formulario'];
      const dados = Object.fromEntries(new FormData(form));
      const imc = (dados.peso / ((dados.altura / 100) ** 2)).toFixed(2);
      const resumoHTML = `
        <h3>Resumo da Consulta</h3>
        <p><strong>Nome:</strong> ${dados.nome}</p>
        <p><strong>Idade:</strong> ${dados.idade} anos</p>
        <p><strong>Peso:</strong> ${dados.peso} kg</p>
        <p><strong>Altura:</strong> ${dados.altura} cm</p>
        <p><strong>IMC:</strong> ${imc}</p>
        <p><strong>PressÃ£o Arterial:</strong> ${dados.pa}</p>
        <p><strong>PrÃ³xima consulta:</strong> ${dados.proxima}</p>
      `;
      document.getElementById("resumo").innerHTML = resumoHTML;
      document.getElementById("resumo").style.display = "block";
      document.getElementById("acoes").style.display = "flex";
    }

    function baixarPDF(printAfter = false) {
      const doc = new jsPDF();
      doc.setFontSize(16);
      doc.text("Resumo da Consulta", 20, 20);
      doc.setFontSize(12);
      doc.text(document.getElementById("resumo").innerText, 20, 30);
      if (printAfter) {
        window.open(doc.output("bloburl"), '_blank');
      } else {
        doc.save("resumo_consulta.pdf");
      }
    }

    function salvarNoDrive() {
      const doc = new jsPDF();
      doc.text(document.getElementById("resumo").innerText, 20, 20);
      const pdfBlob = doc.output("datauristring");
      const base64 = pdfBlob.split(",")[1];
      const nomePaciente = document.forms['formulario']['nome'].value;
      const semana = new Date().toISOString().split('T')[0];
      const nomeArquivo = `${nomePaciente}_consulta_${semana}.pdf`;
      const payload = {
        contents: JSON.stringify({ nomePaciente, semana, nomeArquivo, base64Apdf: base64, folderId: DRIVE_FOLDER_ID })
      };
      fetch(GAS_URL, {
        method: "POST",
        body: new URLSearchParams(payload),
        headers: { "Content-Type": "application/x-www-form-urlencoded" }
      })
        .then(r => r.text())
        .then(res => document.getElementById("mensagemStatus").innerText = res)
        .catch(err => document.getElementById("mensagemStatus").innerText = "Erro: " + err);
    }

    function enviarWhatsApp() {
      const form = document.forms['formulario'];
      const dados = Object.fromEntries(new FormData(form));
      const mensagem = `Ficha de Consulta:\nNome: ${dados.nome}\nIdade: ${dados.idade}\nPeso: ${dados.peso} kg\nAltura: ${dados.altura} cm\nIMC: ${(dados.peso / ((dados.altura / 100) ** 2)).toFixed(2)}\nPA: ${dados.pa}\nPrÃ³xima: ${dados.proxima}`;
      const url = `https://wa.me/?text=${encodeURIComponent(mensagem)}`;
      window.open(url, '_blank');
    }
  </script>
</body>
</html>



